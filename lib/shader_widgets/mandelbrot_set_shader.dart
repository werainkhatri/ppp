import 'dart:convert';
import 'dart:typed_data';
import 'dart:ui';

import 'package:umbra_flutter/umbra_flutter.dart';

/// {@template mandelbrot_set_shader}
/// A Flutter Widget for the `mandelbrot_set_shader` shader.
/// {@endtemplate}
class MandelbrotSetShader extends UmbraWidget {
  /// {@macro mandelbrot_set_shader}
  const MandelbrotSetShader({
    super.key,
    super.blendMode = BlendMode.src,
    super.child,
    super.errorBuilder,
    super.compilingBuilder,
  })  : super();

  static Future<FragmentProgram>? _cachedProgram;

  @override
  List<double> getFloatUniforms() {
    return [];
  }

  @override
  List<ImageShader> getSamplerUniforms() {
    return [];
  }

  @override
  Future<FragmentProgram> program() {
    return _cachedProgram ??
        FragmentProgram.compile(
          spirv: Uint8List.fromList(base64Decode(_spirv)).buffer,
        );
  }
}

const _spirv =
    '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';
